sourceSets {

    modRun {
        runtimeClasspath += rootProject.tasks.jar.outputs.files
        runtimeClasspath += configurations.runtimeClasspath
    }

}

modloader {

    metadata {
        entryPoints([
                "preLaunch": ["nl.elec332.minecraft.loader.impl.fabric.FabricPreLoader"],
                "server": ["nl.elec332.minecraft.loader.impl.fabric.FabricServerInitializer"]
        ])
    }

    mixin {
        mixinPackage = "nl.elec332.minecraft.loader.impl.fabriclike.mixin.plugin"
        plugin = "nl.elec332.minecraft.loader.impl.fabriclike.mixin.plugin.FabricLikeMixinPlugin"
        refMap = "empty.elecloader.refmap.json"
    }

    mixin {
        mixinPackage = "nl.elec332.minecraft.loader.impl.fabric.mixin"
        clientMixins = ["ClientModLoaderMixin"]
    }

    addApiDependency = false
    runtimeSource = sourceSets.modRun

}

compileModRunJava.enabled = false
processModRunResources.enabled = false
mkdir("build/resources/modRun")
mkdir("build/classes/java/modRun")

tasks.modRunClasses.dependsOn(rootProject.tasks.jar)
tasks.jar.finalizedBy(tasks.remapJar)

dependencies {
    compileOnly(project(":repackaged"))
    compileOnly(project(":common"))
}
